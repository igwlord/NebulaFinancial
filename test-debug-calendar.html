<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Test Debug Calendario</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">🔧 Debug Test Calendario</h1>
        
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">🎮 Tests de Debug</h2>            <div class="flex gap-4 flex-wrap">
                <button id="open-app" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg">
                    📱 Abrir App
                </button>
                <button id="test-calendar-direct" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 rounded-lg">
                    🎯 Test Directo
                </button>
                <button id="test-calendar-button" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg">
                    🔍 Test Botón Calendario
                </button>
                <button id="test-modal-open" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg">
                    📋 Test Modal Abierto
                </button>
                <button id="test-elements" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg">
                    🧩 Test Elementos
                </button>
            </div>
        </div>

        <div id="log-results" class="bg-gray-800 rounded-lg p-6">
            <h3 class="text-lg font-bold mb-4">📝 Log de Debug</h3>
            <div id="log-content" class="text-sm font-mono space-y-2">
                <!-- Los logs aparecerán aquí -->
            </div>
        </div>
    </div>

    <script>
        let appWindow = null;

        function log(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `<div class="text-green-400">[${timestamp}] ${message}</div>`;
            logContent.scrollTop = logContent.scrollHeight;
            console.log(message);
        }

        function error(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `<div class="text-red-400">[${timestamp}] ERROR: ${message}</div>`;
            logContent.scrollTop = logContent.scrollHeight;
            console.error(message);
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }        // Abrir app
        document.getElementById('open-app').addEventListener('click', async () => {
            log('🚀 Abriendo aplicación...');
            const appUrl = window.location.href.replace('test-debug-calendar.html', 'index-lab.html');
            
            try {
                appWindow = window.open(appUrl, '_blank');
                
                if (!appWindow) {
                    error('No se pudo abrir la aplicación (bloqueador de pop-ups?)');
                    log('💡 Intenta abrir manualmente: ' + appUrl);
                    log('💡 O copia este enlace en una nueva pestaña:');
                    log('🔗 ' + appUrl);
                    return;
                }

                log('✅ Aplicación abierta correctamente');
                
                // Esperar a que cargue
                await wait(3000);
                
                // Verificar que la ventana sigue abierta
                if (appWindow.closed) {
                    error('La ventana de la aplicación se cerró inesperadamente');
                    return;
                }
                
                log('⏱️ Carga completa, aplicación lista para testing');
                
            } catch (err) {
                error(`Error al abrir aplicación: ${err.message}`);
                log('💡 Abre manualmente la aplicación en otra pestaña: index-lab.html');
            }
        });

        // Test botón calendario
        document.getElementById('test-calendar-button').addEventListener('click', async () => {
            if (!appWindow || appWindow.closed) {
                error('La aplicación no está abierta');
                return;
            }

            log('🔍 Buscando botón del calendario...');

            try {
                // Buscar por diferentes selectores
                const buttonById = appWindow.document.getElementById('calendar-button');
                const buttonByClass = appWindow.document.querySelector('.header-calendar-button');
                const allCalendarBtns = appWindow.document.querySelectorAll('[id*="calendar"], [class*="calendar"]');

                log(`📋 Botón por ID: ${buttonById ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 Botón por clase: ${buttonByClass ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 Todos los elementos con "calendar": ${allCalendarBtns.length} encontrados`);

                if (allCalendarBtns.length > 0) {
                    log('🔍 Lista de elementos encontrados:');
                    allCalendarBtns.forEach((btn, index) => {
                        log(`  ${index + 1}. ID: ${btn.id || 'N/A'}, Clase: ${btn.className || 'N/A'}`);
                    });
                }

                const button = buttonById || buttonByClass;
                if (button) {
                    log('✅ Botón encontrado, probando click...');
                    button.click();
                    await wait(500);
                    log('🖱️ Click ejecutado en el botón');
                } else {
                    error('❌ Botón del calendario no encontrado');
                }

            } catch (err) {
                error(`Error al buscar botón: ${err.message}`);
            }
        });

        // Test modal abierto
        document.getElementById('test-modal-open').addEventListener('click', async () => {
            if (!appWindow || appWindow.closed) {
                error('La aplicación no está abierta');
                return;
            }

            log('📋 Verificando si el modal está abierto...');

            try {
                const modalRoot = appWindow.document.getElementById('modal-root');
                const modalContainer = appWindow.document.querySelector('.modal-container');
                const appState = appWindow.appState;

                log(`📋 Modal root: ${modalRoot ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 Modal container: ${modalContainer ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 AppState activeModal: ${appState ? appState.activeModal : 'N/A'}`);

                if (modalContainer) {
                    log('✅ Modal está abierto');
                    log(`📋 HTML del modal: ${modalContainer.innerHTML.length} caracteres`);
                } else {
                    error('❌ Modal no está abierto');
                }

            } catch (err) {
                error(`Error al verificar modal: ${err.message}`);
            }
        });

        // Test elementos del calendario
        document.getElementById('test-elements').addEventListener('click', async () => {
            if (!appWindow || appWindow.closed) {
                error('La aplicación no está abierta');
                return;
            }

            log('🧩 Verificando elementos del calendario...');

            try {
                const yearInput = appWindow.document.getElementById('calendar-year-input');
                const todayBtn = appWindow.document.getElementById('calendar-today-btn');
                const closeBtn = appWindow.document.getElementById('calendar-close-btn');
                const monthButtons = appWindow.document.querySelectorAll('.calendar-month-btn');

                log(`📋 Input de año: ${yearInput ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 Botón "Ir a Hoy": ${todayBtn ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 Botón cerrar: ${closeBtn ? 'ENCONTRADO' : 'NO ENCONTRADO'}`);
                log(`📋 Botones de mes: ${monthButtons.length} encontrados`);

                if (yearInput) {
                    log(`📋 Valor del input de año: "${yearInput.value}"`);
                    log(`📋 Input está enfocable: ${!yearInput.disabled && !yearInput.readOnly}`);
                }

                if (monthButtons.length > 0) {
                    log(`📋 Primer botón de mes: "${monthButtons[0].textContent.trim()}"`);
                }

            } catch (err) {
                error(`Error al verificar elementos: ${err.message}`);
            }        });

        // Test directo - redirigir a la página de test directo
        document.getElementById('test-calendar-direct').addEventListener('click', () => {
            log('🎯 Redirigiendo a test directo...');
            window.location.href = 'test-calendario-directo.html';
        });

        log('🎯 Test Debug iniciado. Haz clic en "Abrir App" para comenzar.');
    </script>
</body>
</html>
