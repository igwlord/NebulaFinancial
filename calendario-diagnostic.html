<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test Calendario - Diagn√≥stico Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">üîß Diagn√≥stico Calendario - Nebula Finance</h1>
        
        <!-- Bot√≥n para abrir la app principal -->
        <div class="bg-blue-900 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üì± App Principal</h2>
            <div class="flex gap-4">
                <button onclick="openMainApp()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
                    üöÄ Abrir index-LAB.html
                </button>
                <button onclick="testCalendarInMainApp()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">
                    üóìÔ∏è Test Calendario en App
                </button>
            </div>
        </div>

        <!-- Diagn√≥stico -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üîç Diagn√≥stico Autom√°tico</h2>
            <button onclick="runDiagnostic()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg mb-4">
                ‚ñ∂Ô∏è Ejecutar Diagn√≥stico
            </button>
            <div id="diagnostic-results" class="bg-black rounded p-4 text-sm font-mono h-64 overflow-y-auto">
                <div class="text-green-400">Esperando diagn√≥stico...</div>
            </div>
        </div>

        <!-- Manual de pruebas -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">üìã Manual de Pruebas</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-700 rounded p-4">
                    <h3 class="font-semibold mb-2">‚úÖ Lo que DEBE funcionar:</h3>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Click en calendario abre modal</li>
                        <li>‚Ä¢ Bot√≥n X cierra modal</li>
                        <li>‚Ä¢ Click fuera cierra modal</li>
                        <li>‚Ä¢ Botones ‚Üê ‚Üí cambian a√±o</li>
                        <li>‚Ä¢ Click en mes navega y cierra</li>
                        <li>‚Ä¢ "Ir a Hoy" funciona</li>
                        <li>‚Ä¢ Meses muestran colores correctos</li>
                    </ul>
                </div>
                <div class="bg-gray-700 rounded p-4">
                    <h3 class="font-semibold mb-2">‚ùå Problemas reportados:</h3>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Modal no responde a clicks</li>
                        <li>‚Ä¢ Botones no funcionan</li>
                        <li>‚Ä¢ No se puede cerrar modal</li>
                        <li>‚Ä¢ Navegaci√≥n de a√±o no funciona</li>
                        <li>‚Ä¢ Selecci√≥n de mes no responde</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const diagnosticResults = document.getElementById('diagnostic-results');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': 'text-blue-300',
                'success': 'text-green-300',
                'error': 'text-red-300',
                'warning': 'text-yellow-300'
            };
            
            console.log(`[${timestamp}] ${message}`);
            diagnosticResults.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            diagnosticResults.scrollTop = diagnosticResults.scrollHeight;
        }

        function openMainApp() {
            log('üöÄ Abriendo aplicaci√≥n principal...', 'info');
            window.open('http://localhost:8000/index-LAB.html', '_blank');
        }

        async function testCalendarInMainApp() {
            log('üß™ Iniciando test del calendario en app principal...', 'info');
            
            try {
                // Abrir la app en una nueva ventana
                const appWindow = window.open('http://localhost:8000/index-LAB.html', '_blank');
                
                if (!appWindow) {
                    log('‚ùå No se pudo abrir la ventana. Verifica los popups.', 'error');
                    return;
                }

                log('‚è≥ Esperando que la app cargue...', 'warning');
                
                // Esperar a que la app cargue
                setTimeout(() => {
                    try {
                        // Intentar acceder al DOM de la app
                        const appDoc = appWindow.document;
                        log('‚úÖ Acceso al DOM de la app obtenido', 'success');
                        
                        // Buscar elementos cr√≠ticos
                        const calendarButton = appDoc.querySelector('[onclick*="calendar"]') || 
                                             appDoc.querySelector('[data-modal="calendar"]') ||
                                             appDoc.querySelector('.calendar-trigger');
                        
                        if (calendarButton) {
                            log('‚úÖ Bot√≥n del calendario encontrado', 'success');
                            log(`üìç Selector: ${calendarButton.className}`, 'info');
                        } else {
                            log('‚ùå Bot√≥n del calendario NO encontrado', 'error');
                        }

                        // Verificar if modal root exists
                        const modalRoot = appDoc.getElementById('modal-root');
                        if (modalRoot) {
                            log('‚úÖ Modal root encontrado', 'success');
                        } else {
                            log('‚ùå Modal root NO encontrado', 'error');
                        }

                        // Verificar appState
                        if (appWindow.appState) {
                            log('‚úÖ appState disponible', 'success');
                            log(`üìä Tema actual: ${appWindow.appState.themeKey}`, 'info');
                        } else {
                            log('‚ùå appState NO disponible', 'error');
                        }

                    } catch (error) {
                        log(`‚ùå Error accediendo a la app: ${error.message}`, 'error');
                    }
                }, 3000);

            } catch (error) {
                log(`‚ùå Error general: ${error.message}`, 'error');
            }
        }

        async function runDiagnostic() {
            log('üîç Iniciando diagn√≥stico autom√°tico...', 'info');
            diagnosticResults.innerHTML = '';
            
            // Test 1: Verificar servidor local
            log('üì° Test 1: Verificando servidor local...', 'info');
            try {
                const response = await fetch('http://localhost:8000/');
                if (response.ok) {
                    log('‚úÖ Servidor local funcionando', 'success');
                } else {
                    log('‚ö†Ô∏è Servidor local responde pero con errores', 'warning');
                }
            } catch (error) {
                log('‚ùå Servidor local no disponible', 'error');
                log('üí° Ejecuta: python -m http.server 8000', 'info');
            }

            // Test 2: Verificar archivo principal
            log('üìÑ Test 2: Verificando archivo principal...', 'info');
            try {
                const response = await fetch('http://localhost:8000/index-LAB.html');
                if (response.ok) {
                    log('‚úÖ index-LAB.html accesible', 'success');
                    const content = await response.text();
                    
                    // Verificar elementos cr√≠ticos en el HTML
                    if (content.includes('modal-root')) {
                        log('‚úÖ modal-root encontrado en HTML', 'success');
                    } else {
                        log('‚ùå modal-root NO encontrado en HTML', 'error');
                    }

                    if (content.includes('renderCalendarModal')) {
                        log('‚úÖ renderCalendarModal encontrado', 'success');
                    } else {
                        log('‚ùå renderCalendarModal NO encontrado', 'error');
                    }

                    if (content.includes('appState')) {
                        log('‚úÖ appState encontrado', 'success');
                    } else {
                        log('‚ùå appState NO encontrado', 'error');
                    }

                } else {
                    log('‚ùå No se puede acceder a index-LAB.html', 'error');
                }
            } catch (error) {
                log(`‚ùå Error verificando archivo: ${error.message}`, 'error');
            }

            // Test 3: Verificar archivos de debug
            log('üß™ Test 3: Verificando archivos de debug...', 'info');
            const debugFiles = [
                'debug-calendar-gmail.html',
                'test-calendar-only.html',
                'test-gmail-login.html'
            ];

            for (const file of debugFiles) {
                try {
                    const response = await fetch(`http://localhost:8000/${file}`);
                    if (response.ok) {
                        log(`‚úÖ ${file} disponible`, 'success');
                    } else {
                        log(`‚ùå ${file} no disponible`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå Error con ${file}: ${error.message}`, 'error');
                }
            }

            // Test 4: Verificar dependencias
            log('üì¶ Test 4: Verificando dependencias...', 'info');
            try {
                const response = await fetch('https://cdn.tailwindcss.com');
                if (response.ok) {
                    log('‚úÖ Tailwind CSS disponible', 'success');
                } else {
                    log('‚ö†Ô∏è Problema con Tailwind CSS', 'warning');
                }
            } catch (error) {
                log('‚ùå Problema de red con dependencias', 'error');
            }

            log('üéØ Diagn√≥stico completado', 'success');
            log('üí° Si hay problemas, usa los archivos de debug primero', 'info');
        }

        // Auto-run diagn√≥stico
        log('üéØ Test de diagn√≥stico listo', 'info');
        log('üìù Instrucciones:', 'info');
        log('1. Ejecuta diagn√≥stico autom√°tico', 'info');
        log('2. Abre la app principal', 'info');
        log('3. Prueba el calendario manualmente', 'info');
        log('4. Reporta qu√© funciona y qu√© no', 'info');
    </script>
</body>
</html>
