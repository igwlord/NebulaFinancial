<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test Espec√≠fico - Elementos Problem√°ticos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-panel {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .test-button {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        .debug-panel {
            background: #1f2937;
            color: #f3f4f6;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status-ok { color: #10b981; }
        .status-error { color: #ef4444; }
        .status-warning { color: #f59e0b; }
        
        /* Estilos espec√≠ficos para el modal del calendario */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }
        
        .calendar-month-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 12px;
            margin: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-month-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">
            üîß Test Espec√≠fico - Elementos Problem√°ticos
        </h1>
        
        <div class="test-panel">
            <h2 class="text-2xl font-bold mb-4">üéØ Tests de Elementos Espec√≠ficos</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button class="test-button" onclick="testYearInputSpecific()">
                    üìù Test Input A√ëO
                </button>
                <button class="test-button" onclick="testTodayButtonSpecific()">
                    üè† Test IR A HOY
                </button>
                <button class="test-button" onclick="testCloseButtonSpecific()">
                    ‚ùå Test CERRAR X
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <button class="test-button" onclick="openCalendarForTesting()">
                    üìÖ Abrir Calendario
                </button>
                <button class="test-button" onclick="runSpecificTests()">
                    üî¨ Test Completo
                </button>
            </div>
        </div>
        
        <div class="debug-panel" id="debug-output">
            <div class="status-warning">üîß Sistema de Test Espec√≠fico Iniciado</div>
            <div class="status-warning">‚ö†Ô∏è Este test se enfoca en los 3 elementos problem√°ticos</div>
        </div>
        
        <!-- Modal para el calendario -->
        <div id="modal-root"></div>
    </div>

    <script>
        // ============================================
        // üéØ SIMULACI√ìN DEL APPSTATE Y FUNCIONES CORE
        // ============================================
        
        const appState = {
            activeModal: null,
            currentDate: new Date(),
            calendarViewYear: new Date().getFullYear(),
            
            openModal: function(modalType) {
                this.activeModal = modalType;
                log(`üìÖ Modal abierto: ${modalType}`, 'ok');
                
                const modalRoot = document.getElementById('modal-root');
                if (modalRoot) {
                    modalRoot.innerHTML = renderCalendarModal();
                    addModalEventListeners();
                }
            },
            
            closeModal: function() {
                log(`‚ùå Cerrando modal: ${this.activeModal}`, 'warning');
                this.activeModal = null;
                
                const modalRoot = document.getElementById('modal-root');
                if (modalRoot) {
                    modalRoot.innerHTML = '';
                }
            }
        };
        
        // ============================================
        // üìÖ RENDERIZADO DEL MODAL DEL CALENDARIO
        // ============================================
        
        function renderCalendarModal() {
            const currentYear = appState.calendarViewYear;
            const today = new Date();
            const currentMonth = today.getMonth();
            
            const months = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            
            const monthsGrid = months.map((month, index) => {
                return `
                    <button 
                        class="calendar-month-btn"
                        data-month-index="${index}"
                        data-month-name="${month}"
                    >
                        ${month}
                    </button>
                `;
            }).join('');
            
            return `
                <div class="modal-overlay" id="calendar-modal-overlay">
                    <div class="modal-content">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">üìÖ Seleccionar Fecha</h2>
                            <button class="modal-close-button text-gray-500 hover:text-gray-700 text-2xl" id="calendar-close-btn">
                                ‚úï
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">A√±o:</label>
                            <input 
                                type="number" 
                                id="calendar-year-input" 
                                value="${currentYear}" 
                                min="1900" 
                                max="2100"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-700 mb-3">Selecciona un mes:</h3>
                            <div class="grid grid-cols-3 gap-2">
                                ${monthsGrid}
                            </div>
                        </div>
                        
                        <div class="flex justify-between">
                            <button id="calendar-today-btn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                                üè† Ir a Hoy
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ============================================
        // üîß CONFIGURACI√ìN DE EVENTOS CON CLONADO
        // ============================================
        
        function addModalEventListeners() {
            log('üé≠ INICIO addModalEventListeners() ESPEC√çFICO', 'ok');
            
            setTimeout(() => {
                setupSpecificEvents();
            }, 200);
        }
        
        function setupSpecificEvents() {
            log('üîß CONFIGURANDO EVENTOS ESPEC√çFICOS CON CLONADO...', 'ok');
            
            // 1. INPUT DE A√ëO
            const yearInput = document.getElementById('calendar-year-input');
            if (yearInput) {
                log('üìù Configurando INPUT DE A√ëO con clonado...', 'ok');
                
                const newYearInput = yearInput.cloneNode(true);
                yearInput.parentNode.replaceChild(newYearInput, yearInput);
                
                newYearInput.addEventListener('change', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    log('üéØ INPUT A√ëO - FUNCIONANDO: ' + e.target.value, 'ok');
                    
                    const newYear = parseInt(e.target.value);
                    if (!isNaN(newYear) && newYear >= 1900 && newYear <= 2100) {
                        appState.calendarViewYear = newYear;
                        log('‚úÖ A√±o actualizado a: ' + newYear, 'ok');
                    }
                });
                
                newYearInput.addEventListener('focus', () => {
                    log('üëÅÔ∏è INPUT A√ëO - Focus recibido', 'ok');
                });
                
                newYearInput.addEventListener('blur', () => {
                    log('üëÅÔ∏è INPUT A√ëO - Focus perdido', 'warning');
                });
                
                // Forzar estilos
                newYearInput.style.pointerEvents = 'auto';
                newYearInput.style.cursor = 'text';
                newYearInput.style.zIndex = '1001';
                
                log('‚úÖ INPUT A√ëO configurado correctamente', 'ok');
            } else {
                log('‚ùå INPUT A√ëO NO ENCONTRADO', 'error');
            }
            
            // 2. BOT√ìN IR A HOY
            const todayBtn = document.getElementById('calendar-today-btn');
            if (todayBtn) {
                log('üè† Configurando BOT√ìN IR A HOY con clonado...', 'ok');
                
                const newTodayBtn = todayBtn.cloneNode(true);
                todayBtn.parentNode.replaceChild(newTodayBtn, todayBtn);
                
                newTodayBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    log('üéØ BOT√ìN IR A HOY - FUNCIONANDO', 'ok');
                    
                    const today = new Date();
                    appState.currentDate = today;
                    appState.calendarViewYear = today.getFullYear();
                    appState.closeModal();
                    
                    log('‚úÖ Navegado a hoy correctamente', 'ok');
                });
                
                newTodayBtn.addEventListener('mouseenter', () => {
                    log('üëÜ BOT√ìN HOY - Mouse enter', 'ok');
                });
                
                // Forzar estilos
                newTodayBtn.style.pointerEvents = 'auto';
                newTodayBtn.style.cursor = 'pointer';
                newTodayBtn.style.zIndex = '1001';
                
                log('‚úÖ BOT√ìN IR A HOY configurado correctamente', 'ok');
            } else {
                log('‚ùå BOT√ìN IR A HOY NO ENCONTRADO', 'error');
            }
            
            // 3. BOT√ìN CERRAR
            const closeBtn = document.getElementById('calendar-close-btn');
            if (closeBtn) {
                log('‚ùå Configurando BOT√ìN CERRAR con clonado...', 'ok');
                
                const newCloseBtn = closeBtn.cloneNode(true);
                closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
                
                newCloseBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    log('üéØ BOT√ìN CERRAR - FUNCIONANDO', 'ok');
                    appState.closeModal();
                });
                
                newCloseBtn.addEventListener('mouseenter', () => {
                    log('üëÜ BOT√ìN CERRAR - Mouse enter', 'ok');
                });
                
                // Forzar estilos
                newCloseBtn.style.pointerEvents = 'auto';
                newCloseBtn.style.cursor = 'pointer';
                newCloseBtn.style.zIndex = '1001';
                
                log('‚úÖ BOT√ìN CERRAR configurado correctamente', 'ok');
            } else {
                log('‚ùå BOT√ìN CERRAR NO ENCONTRADO', 'error');
            }
            
            log('üèÅ CONFIGURACI√ìN ESPEC√çFICA COMPLETADA', 'ok');
        }
        
        // ============================================
        // üî¨ FUNCIONES DE TESTING ESPEC√çFICAS
        // ============================================
        
        function log(message, type = 'ok') {
            const debugOutput = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = 'status-' + type;
            
            const logLine = document.createElement('div');
            logLine.className = statusClass;
            logLine.textContent = `[${timestamp}] ${message}`;
            
            debugOutput.appendChild(logLine);
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }
        
        function clearDebug() {
            document.getElementById('debug-output').innerHTML = '';
        }
        
        function openCalendarForTesting() {
            clearDebug();
            log('üìÖ ABRIENDO CALENDARIO PARA TESTING...', 'ok');
            appState.openModal('calendar');
        }
        
        function testYearInputSpecific() {
            log('üìù TEST ESPEC√çFICO: INPUT A√ëO', 'warning');
            
            const yearInput = document.getElementById('calendar-year-input');
            if (!yearInput) {
                log('‚ùå Input a√±o no encontrado - abre el calendario primero', 'error');
                return;
            }
            
            log('üìù Input a√±o encontrado - probando...', 'ok');
            
            // Test focus
            yearInput.focus();
            log('‚úÖ Focus aplicado al input', 'ok');
            
            // Test cambio de valor
            yearInput.value = '2030';
            const changeEvent = new Event('change', { bubbles: true });
            yearInput.dispatchEvent(changeEvent);
            
            log('‚úÖ Valor cambiado a 2030 y evento disparado', 'ok');
        }
        
        function testTodayButtonSpecific() {
            log('üè† TEST ESPEC√çFICO: BOT√ìN IR A HOY', 'warning');
            
            const todayBtn = document.getElementById('calendar-today-btn');
            if (!todayBtn) {
                log('‚ùå Bot√≥n "Ir a Hoy" no encontrado - abre el calendario primero', 'error');
                return;
            }
            
            log('üè† Bot√≥n "Ir a Hoy" encontrado - probando click...', 'ok');
            todayBtn.click();
            
            setTimeout(() => {
                log('‚úÖ Click en bot√≥n "Ir a Hoy" completado', 'ok');
            }, 100);
        }
        
        function testCloseButtonSpecific() {
            log('‚ùå TEST ESPEC√çFICO: BOT√ìN CERRAR', 'warning');
            
            const closeBtn = document.getElementById('calendar-close-btn');
            if (!closeBtn) {
                log('‚ùå Bot√≥n cerrar no encontrado - abre el calendario primero', 'error');
                return;
            }
            
            log('‚ùå Bot√≥n cerrar encontrado - probando click...', 'ok');
            closeBtn.click();
            
            setTimeout(() => {
                log('‚úÖ Click en bot√≥n cerrar completado', 'ok');
            }, 100);
        }
        
        function runSpecificTests() {
            clearDebug();
            log('üî¨ INICIANDO TESTS ESPEC√çFICOS COMPLETOS...', 'ok');
            
            // Abrir calendario
            openCalendarForTesting();
            
            // Tests secuenciales
            setTimeout(() => testYearInputSpecific(), 500);
            setTimeout(() => testTodayButtonSpecific(), 1000);
            setTimeout(() => {
                // Reabrir para test de cerrar
                openCalendarForTesting();
                setTimeout(() => testCloseButtonSpecific(), 200);
            }, 1500);
            
            setTimeout(() => {
                log('üèÅ TESTS ESPEC√çFICOS COMPLETADOS', 'ok');
            }, 2500);
        }
        
        // ============================================
        // üéØ INICIALIZACI√ìN
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            log('üîß Test Espec√≠fico de Elementos Problem√°ticos - Iniciado', 'ok');
            log('üìã Usa los botones para probar cada elemento individualmente', 'warning');
        });
    </script>
</body>
</html>
