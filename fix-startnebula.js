        function startNebula() {
            if (nebulaStarted) {
                console.log('‚ö†Ô∏è Nebula ya est√° iniciado, ignorando llamada duplicada');
                return;
            }
            
            // Verificar si ya se renderiz√≥ la aplicaci√≥n (indica √©xito previo)
            if (document.querySelector('#content-root').innerHTML.trim() !== '') {
                console.log('‚ö†Ô∏è Aplicaci√≥n ya renderizada, ignorando startNebula duplicado');
                nebulaStarted = true;
                window.nebulaStarted = true;
                return;
            }
            
            try {
                nebulaStarted = true;
                window.nebulaStarted = true;
                console.log('üöÄ Iniciando Nebula Financial...');
                
                // Verificar elementos DOM
                const elements = ['content-root', 'dock-root', 'parallax-bg', 'modal-root'];
                const domElements = elements.map(id => document.getElementById(id));
                
                if (domElements.some(el => !el)) {
                    console.error('‚ùå Elementos DOM faltantes:', elements.filter((_, i) => !domElements[i]));
                    throw new Error('Elementos DOM no encontrados');
                }
                
                // Asignar elementos a variables globales
                [contentRoot, dockRoot, parallaxBg, modalRoot] = domElements;
                
                // Verificar objetos necesarios
                if (!THEMES || !ICONS || !appState) {
                    throw new Error('Objetos globales no definidos');
                }
                
                // üåç EXPOSICI√ìN GLOBAL CR√çTICA - Para compatibilidad con m√≥dulos
                window.appState = appState;
                window.THEMES = THEMES;
                window.ICONS = ICONS;
                window.renderApp = renderApp;
                
                // Funci√≥n global para aplicar autoformato num√©rico
                window.formatThousands = function(value) {
                    if (!value) return '';
                    // Remover todo excepto n√∫meros
                    const cleanValue = value.toString().replace(/[^\d]/g, '');
                    // Aplicar formato con puntos cada 3 d√≠gitos
                    return cleanValue.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                };
                
                window.applyThousandsFormatting = function(input) {
                    if (!input) return;
                    
                    // Evento input para formateo en tiempo real
                    input.addEventListener('input', (e) => {
                        const cursorPosition = e.target.selectionStart;
                        const oldValue = e.target.value;
                        const newValue = window.formatThousands(oldValue);
                        
                        // Solo actualizar si cambi√≥ el valor
                        if (newValue !== oldValue) {
                            e.target.value = newValue;
                            
                            // Mantener posici√≥n del cursor
                            const newCursorPosition = cursorPosition + (newValue.length - oldValue.length);
                            e.target.setSelectionRange(newCursorPosition, newCursorPosition);
                        }
                    });
                    
                    // Formatear valor inicial si existe
                    if (input.value) {
                        input.value = window.formatThousands(input.value);
                    }
                };
                
                window.applyNumericFormatting = function() {
                    // Aplicar formateo autom√°tico de miles a todos los inputs num√©ricos
                    document.querySelectorAll('.numeric-input').forEach(input => {
                        window.applyThousandsFormatting(input);
                    });
                    
                    // Tambi√©n aplicar a inputs de actualizaci√≥n de inversiones
                    document.querySelectorAll('.update-investment-input').forEach(input => {
                        window.applyThousandsFormatting(input);
                    });
                };
                
                console.log('‚úÖ Objetos globales expuestos correctamente');
                
                // Inicializar sistemas
                ShortcutSystem.init();
                NotificationSystem.init();
                
                // Renderizar aplicaci√≥n
                renderApp();
                
                // üîê INICIALIZAR SISTEMA DE AUTENTICACI√ìN NEBULA
                if (typeof NebulaAuthUI !== 'undefined' && window.NebulaAuth) {
                    console.log('üîê Inicializando sistema de autenticaci√≥n Nebula...');
                    
                    // Usar la instancia global de NebulaAuth
                    window.nebulaAuth = window.NebulaAuth; // Alias para compatibilidad
                    window.nebulaAuthUI = new NebulaAuthUI(window.NebulaAuth);
                    
                    // Configurar listener de estado de autenticaci√≥n
                    window.nebulaAuth.addAuthListener((authData) => {
                        const { user, profile, isAuthenticated } = authData;
                        if (isAuthenticated && user && profile) {
                            console.log('üîê Usuario autenticado:', user.displayName);
                            appState.user = {
                                name: user.displayName || profile.displayName || 'Usuario',
                                email: user.email || profile.email,
                                photoURL: user.photoURL || profile.photoURL,
                                uid: user.uid,
                                provider: 'google',
                                profile: profile
                            };
                            
                            // Cargar datos del usuario desde el perfil
                            if (profile.financialData) {
                                Object.assign(appState, profile.financialData);
                            }
                            
                            // Solo renderizar si renderApp est√° disponible
                            if (typeof renderApp === 'function') {
                                renderApp();
                            } else {
                                console.log('‚è≥ renderApp no disponible a√∫n');
                            }
                        } else {
                            console.log('üë§ Usuario no autenticado');
                            // Limpiar datos de usuario pero mantener datos locales
                            appState.user = null;
                        }
                    });
                    
                    // La inicializaci√≥n de NebulaAuth se hace autom√°ticamente en el constructor
                    console.log('‚úÖ Sistema de autenticaci√≥n Nebula configurado');
                    
                } else {
                    console.log('‚ö†Ô∏è Sistema de autenticaci√≥n Nebula no disponible');
                    
                    // üî• Fallback a Firebase Authentication b√°sico
                    if (window.firebaseAuth && window.onAuthStateChanged) {
                        window.onAuthStateChanged(window.firebaseAuth, (user) => {
                            if (user) {
                                console.log('üî• Usuario autenticado detectado:', user.displayName);
                                if (!appState.user || appState.user.uid !== user.uid) {
                                    appState.user = {
                                        name: user.displayName || 'Usuario de Google',
                                        email: user.email,
                                        photoURL: user.photoURL,
                                        uid: user.uid,
                                        provider: 'google'
                                    };
                                    renderApp();
                                }
                            } else {
                                console.log('üî• No hay usuario autenticado');
                            }
                        });
                    } else {
                        console.log('‚ö†Ô∏è Firebase no disponible, usando autenticaci√≥n local');
                    }
                }
                
                // Configurar dock
                setTimeout(() => {
                    if (typeof updateDockGlider === 'function') {
                        updateDockGlider();
                    }
                }, 200);
                
                // Mostrar mensaje de bienvenida si es la primera vez
                const isFirstVisit = NebulaSecurityUtils ? 
                    !NebulaSecurityUtils.secureGetItem('nebula_visited') :
                    !localStorage.getItem('nebula_visited');
                if (isFirstVisit) {
                    if (NebulaSecurityUtils) {
                        NebulaSecurityUtils.secureSetItem('nebula_visited', true);
                    } else {
                        localStorage.setItem('nebula_visited', 'true');
                    }
                    setTimeout(() => {
                        NotificationSystem.info('¬°Bienvenido!', 
                            'Presiona H para ver los atajos de teclado disponibles', 6000);
                    }, 2000);
                }
                
                console.log('‚úÖ Nebula iniciada correctamente');
                
            } catch (error) {
                nebulaStarted = false; // Reset para permitir reintento
                window.nebulaStarted = false;
                console.error('‚ùå Error en inicializaci√≥n:', error);
                
                // Mostrar p√°gina de error
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%); color: white; font-family: 'Inter', Arial, sans-serif;">
                        <div style="text-align: center; padding: 40px; background: rgba(0,0,0,0.4); border-radius: 20px; backdrop-filter: blur(10px); max-width: 500px;">
                            <h1 style="font-size: 3rem; margin-bottom: 1rem;">üåå</h1>
                            <h2 style="font-size: 2rem; margin-bottom: 1rem; color: #e2e8f0;">Nebula Financial</h2>
                            <p style="margin-bottom: 1.5rem; color: #cbd5e1; font-size: 1.1rem;">Iniciando tu universo financiero...</p>
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 2rem; text-align: left;">
                                <small style="color: #fcd34d; font-family: monospace;">${error.message}</small>
                            </div>
                            <button onclick="location.reload()" style="background: linear-gradient(45deg, #22c55e, #16a34a); border: none; color: white; padding: 14px 28px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4); transition: transform 0.2s; margin-right: 10px;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üîÑ Recargar App
                            </button>
                            <button onclick="if(NebulaSecurityUtils) { NebulaSecurityUtils.clearSecurityData(); } else { localStorage.clear(); } location.reload()" style="background: linear-gradient(45deg, #f59e0b, #d97706); border: none; color: white; padding: 14px 28px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üóëÔ∏è Limpiar Datos
                            </button>
                        </div>
                    </div>
                `;
            }
        }
